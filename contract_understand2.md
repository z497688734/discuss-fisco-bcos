
使用0.4.25的编译器

智能合约编译后的字节码，分为三个部分：部署代码、runtime代码、auxdata。

部署代码：以上面的输出结果为例，EVM虚拟机在创建合约的时候，会先创建合约账户，然后运行部署代码。运行完成后它会将runtime代码+auxdata 存储到区块链上。之后再把二者的存储地址跟合约账户关联起来(也就是把合约账户中的code hash字段用该地址赋值)，这样就完成了合约的部署。


runtime代码：运行时代码。

auxdata：每个合约最后面的43字节就是auxdata，它会紧跟在runtime代码后面被存储起来，是源码的加密指纹，用来验证。这只是数据，永远不会被EVM执行。

solc命令的--bin-runtime选项，输出了runtime代码和auxdata，省略了部署代码，使用remix-ide也可以

bytecode

```
60806040526000805534801561001457600080fd5b506040516020806101368339810180604052810190808051906020019092919050505080600f016000819055505060e6806100506000396000f300

6080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680636d4ce63c14604e57806387db03b7146076575b600080fd5b348015605957600080fd5b50606060a0565b6040518082815260200191505060405180910390f35b348015608157600080fd5b50609e6004803603810190808035906020019092919050505060a9565b005b60008054905090565b600e816000540101600081905550505600
//auxdata
a165627a7a72305820902c0ea7bc58fa4d3a23cebb43ad421601d9d35a20db6f2140d28f293b76e81c0029

```
runtime bytecode
```
6080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680636d4ce63c14604e57806387db03b7146076575b600080fd5b348015605957600080fd5b50606060a0565b6040518082815260200191505060405180910390f35b348015608157600080fd5b50609e6004803603810190808035906020019092919050505060a9565b005b60008054905090565b600e816000540101600081905550505600

a165627a7a72305820902c0ea7bc58fa4d3a23cebb43ad421601d9d35a20db6f2140d28f293b76e81c0029
```
bytecode 种包含了部署代码 和 runtime


还使用这一段代码做实验保持为Demo.sol
```
pragma solidity ^0.4.22;
contract Demo{
	int m  = 0;
	constructor(int y) public {
		m = 15 + y;
	}

	function add( int x ) public {
		m = m + x + 14 ;
	}
	function get( ) public view returns (int) {
		return m;
	}
}
```
拷贝到控制台目录下
```
cp ~/Documents/learn/discuss-fisco-bcos/code_and_doc/Demo.sol ~/2cWorkPlace/demo-fisco-bcos/demo2/nodes/127.0.0.1/console/contracts/solidity/Demo.sol
```

部署合约，查看交易详情
```
deploy Demo  1

//部署代码
0x60806040526000805534801561001457600080fd5b506040516020806101368339810180604052810190808051906020019092919050505080600f016000819055505060e6806100506000396000f300

//runtime
6080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680636d4ce63c14604e57806387db03b7146076575b600080fd5b348015605957600080fd5b50606060a0565b6040518082815260200191505060405180910390f35b348015608157600080fd5b50609e6004803603810190808035906020019092919050505060a9565b005b60008054905090565b600e816000540101600081905550505600a165627a7a72305820902c0ea7bc58fa4d3a23cebb43ad421601d9d35a20db6f2140d28f293b76e81c0029

//输入
0000000000000000000000000000000000000000000000000000000000000001
```
最后64位表示输入参数;

查看整个汇编代码
```
.code
  PUSH 80			contract Demo{\n\tint m  = 0;\...
  PUSH 40			contract Demo{\n\tint m  = 0;\...
  MSTORE 			contract Demo{\n\tint m  = 0;\...
  PUSH 0			0
  DUP1 			int m  = 0
  SSTORE 			int m  = 0
  CALLVALUE 			constructor(int y) public {\n\...
  DUP1 			olidity ^
  ISZERO 			a
  PUSH [tag] 1			a
  JUMPI 			a
  PUSH 0			a
  DUP1 			n
  REVERT 			.22;\ncontrac
tag 1			a
  JUMPDEST 			a
  POP 			constructor(int y) public {\n\...
  PUSH 40			constructor(int y) public {\n\...
  MLOAD 			constructor(int y) public {\n\...
  PUSH 20			constructor(int y) public {\n\...
  DUP1 			constructor(int y) public {\n\...
  PUSHSIZE 			constructor(int y) public {\n\...
  DUP4 			constructor(int y) public {\n\...
  CODECOPY 			constructor(int y) public {\n\...
  DUP2 			constructor(int y) public {\n\...
  ADD 			constructor(int y) public {\n\...
  DUP1 			constructor(int y) public {\n\...
  PUSH 40			constructor(int y) public {\n\...
  MSTORE 			constructor(int y) public {\n\...
  DUP2 			constructor(int y) public {\n\...
  ADD 			constructor(int y) public {\n\...
  SWAP1 			constructor(int y) public {\n\...
  DUP1 			constructor(int y) public {\n\...
  DUP1 			constructor(int y) public {\n\...
  MLOAD 			constructor(int y) public {\n\...
  SWAP1 			constructor(int y) public {\n\...
  PUSH 20			constructor(int y) public {\n\...
  ADD 			constructor(int y) public {\n\...
  SWAP1 			constructor(int y) public {\n\...
  SWAP3 			constructor(int y) public {\n\...
  SWAP2 			constructor(int y) public {\n\...
  SWAP1 			constructor(int y) public {\n\...
  POP 			constructor(int y) public {\n\...
  POP 			constructor(int y) public {\n\...
  POP 			constructor(int y) public {\n\...
  DUP1 			y
  PUSH F			15
  ADD 			15 + y
  PUSH 0			m
  DUP2 			m = 15 + y
  SWAP1 			m = 15 + y
  SSTORE 			m = 15 + y
  POP 			m = 15 + y
  POP 			constructor(int y) public {\n\...
  PUSH #[$] 0000000000000000000000000000000000000000000000000000000000000000			contract Demo{\n\tint m  = 0;\...
  DUP1 			contract Demo{\n\tint m  = 0;\...
  PUSH [$] 0000000000000000000000000000000000000000000000000000000000000000			contract Demo{\n\tint m  = 0;\...
  PUSH 0			contract Demo{\n\tint m  = 0;\...
  CODECOPY 			contract Demo{\n\tint m  = 0;\...
  PUSH 0			contract Demo{\n\tint m  = 0;\...
  RETURN 			contract Demo{\n\tint m  = 0;\...
.data
  0:
    .code
      PUSH 80			contract Demo{\n\tint m  = 0;\...
      PUSH 40			contract Demo{\n\tint m  = 0;\...
      MSTORE 			contract Demo{\n\tint m  = 0;\...
      PUSH 4			contract Demo{\n\tint m  = 0;\...
      CALLDATASIZE 			contract Demo{\n\tint m  = 0;\...
      LT 			contract Demo{\n\tint m  = 0;\...
      PUSH [tag] 1			contract Demo{\n\tint m  = 0;\...
      JUMPI 			contract Demo{\n\tint m  = 0;\...
      PUSH 0			contract Demo{\n\tint m  = 0;\...
      CALLDATALOAD 			contract Demo{\n\tint m  = 0;\...
      PUSH 100000000000000000000000000000000000000000000000000000000			contract Demo{\n\tint m  = 0;\...
      SWAP1 			contract Demo{\n\tint m  = 0;\...
      DIV 			contract Demo{\n\tint m  = 0;\...
      PUSH FFFFFFFF			contract Demo{\n\tint m  = 0;\...
      AND 			contract Demo{\n\tint m  = 0;\...
      DUP1 			contract Demo{\n\tint m  = 0;\...
      PUSH 6D4CE63C			contract Demo{\n\tint m  = 0;\...
      EQ 			contract Demo{\n\tint m  = 0;\...
      PUSH [tag] 2			contract Demo{\n\tint m  = 0;\...
      JUMPI 			contract Demo{\n\tint m  = 0;\...
      DUP1 			contract Demo{\n\tint m  = 0;\...
      PUSH 87DB03B7			contract Demo{\n\tint m  = 0;\...
      EQ 			contract Demo{\n\tint m  = 0;\...
      PUSH [tag] 3			contract Demo{\n\tint m  = 0;\...
      JUMPI 			contract Demo{\n\tint m  = 0;\...
    tag 1			contract Demo{\n\tint m  = 0;\...
      JUMPDEST 			contract Demo{\n\tint m  = 0;\...
      PUSH 0			contract Demo{\n\tint m  = 0;\...
      DUP1 			contract Demo{\n\tint m  = 0;\...
      REVERT 			contract Demo{\n\tint m  = 0;\...
    tag 2			function get( ) public view re...
      JUMPDEST 			function get( ) public view re...
      CALLVALUE 			function get( ) public view re...
      DUP1 			olidity ^
      ISZERO 			a
      PUSH [tag] 4			a
      JUMPI 			a
      PUSH 0			a
      DUP1 			n
      REVERT 			.22;\ncontrac
    tag 4			a
      JUMPDEST 			a
      POP 			function get( ) public view re...
      PUSH [tag] 5			function get( ) public view re...
      PUSH [tag] 6			function get( ) public view re...
      JUMP 			function get( ) public view re...
    tag 5			function get( ) public view re...
      JUMPDEST 			function get( ) public view re...
      PUSH 40			function get( ) public view re...
      MLOAD 			function get( ) public view re...
      DUP1 			function get( ) public view re...
      DUP3 			function get( ) public view re...
      DUP2 			function get( ) public view re...
      MSTORE 			function get( ) public view re...
      PUSH 20			function get( ) public view re...
      ADD 			function get( ) public view re...
      SWAP2 			function get( ) public view re...
      POP 			function get( ) public view re...
      POP 			function get( ) public view re...
      PUSH 40			function get( ) public view re...
      MLOAD 			function get( ) public view re...
      DUP1 			function get( ) public view re...
      SWAP2 			function get( ) public view re...
      SUB 			function get( ) public view re...
      SWAP1 			function get( ) public view re...
      RETURN 			function get( ) public view re...
    tag 3			function add( int x ) public {...
      JUMPDEST 			function add( int x ) public {...
      CALLVALUE 			function add( int x ) public {...
      DUP1 			olidity ^
      ISZERO 			a
      PUSH [tag] 7			a
      JUMPI 			a
      PUSH 0			a
      DUP1 			n
      REVERT 			.22;\ncontrac
    tag 7			a
      JUMPDEST 			a
      POP 			function add( int x ) public {...
      PUSH [tag] 8			function add( int x ) public {...
      PUSH 4			function add( int x ) public {...
      DUP1 			function add( int x ) public {...
      CALLDATASIZE 			function add( int x ) public {...
      SUB 			function add( int x ) public {...
      DUP2 			function add( int x ) public {...
      ADD 			function add( int x ) public {...
      SWAP1 			function add( int x ) public {...
      DUP1 			function add( int x ) public {...
      DUP1 			function add( int x ) public {...
      CALLDATALOAD 			function add( int x ) public {...
      SWAP1 			function add( int x ) public {...
      PUSH 20			function add( int x ) public {...
      ADD 			function add( int x ) public {...
      SWAP1 			function add( int x ) public {...
      SWAP3 			function add( int x ) public {...
      SWAP2 			function add( int x ) public {...
      SWAP1 			function add( int x ) public {...
      POP 			function add( int x ) public {...
      POP 			function add( int x ) public {...
      POP 			function add( int x ) public {...
      PUSH [tag] 9			function add( int x ) public {...
      JUMP 			function add( int x ) public {...
    tag 8			function add( int x ) public {...
      JUMPDEST 			function add( int x ) public {...
      STOP 			function add( int x ) public {...
    tag 6			function get( ) public view re...
      JUMPDEST 			function get( ) public view re...
      PUSH 0			int
      DUP1 			m
      SLOAD 			m
      SWAP1 			return m
      POP 			return m
      SWAP1 			function get( ) public view re...
      JUMP [out]			function get( ) public view re...
    tag 9			function add( int x ) public {...
      JUMPDEST 			function add( int x ) public {...
      PUSH E			14
      DUP2 			x
      PUSH 0			m
      SLOAD 			m
      ADD 			m + x
      ADD 			m + x + 14
      PUSH 0			m
      DUP2 			m = m + x + 14
      SWAP1 			m = m + x + 14
      SSTORE 			m = m + x + 14
      POP 			m = m + x + 14
      POP 			function add( int x ) public {...
      JUMP [out]			function add( int x ) public {...
    .data

```
CODECOPY表示拷贝代码

RETURN    表示执行到此处时整个流程结束


CALLVALUE 获取需要给合约转账的资产；如果是0，则直接进入tag1；否则revert ，因为构造函数没有payable修饰;所以该函数不能进行转账操作。

运行合约的时候，如果是第一次执行这个合约的时候，执行完构造函数内容后有个CODECOPY指令，作用是把后续的内容拷贝到覆盖构造函数的内容，然后返回合约写入statedb中


在"安装时间"和"运行时间"之间有一个强制的分离。无法运行构造器两次



调用操作
```
call Demo 0x07456194d14c1888a6a4358aff384431b48e9159   add 2

getTransactionByHash 0x33359a12f1c6fd57aadd3ed5654f9f3a2644533dba977b67b592ffa3de07caaa

{
    "blockHash":"0x676f254838edc813e14245989c8051ba8ab0c434901149e89ca88f91ee52c4c7",
    "blockNumber":"0x37",
    "from":"0xbd10881e4d4397dd6fe3922efed68847f0aa80c2",
    "gas":"0x11e1a300",
    "gasPrice":"0x11e1a300",
    "hash":"0x33359a12f1c6fd57aadd3ed5654f9f3a2644533dba977b67b592ffa3de07caaa",
    "input":"0x87db03b70000000000000000000000000000000000000000000000000000000000000002",
    "nonce":"0x26fe90f75b671f29d9734be7b1b5de0a7b4f5bf7f21a3033de6fbfa578fe8f7",
    "to":"0x07456194d14c1888a6a4358aff384431b48e9159",
    "transactionIndex":"0x0",
    "value":"0x0"
}

```
看input，把input拆成2部分;0x87db03b7 和0000000000000000000000000000000000000000000000000000000000000002。第一部分是函数名,使用签名的前4个字节，在geth控制台可以验证,第二部分是参数内容.

```
web3.sha3("add(int256)")

```



