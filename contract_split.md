# 合约代码拆分

智能合约编译后的字节码，分为三个部分：部署代码、runtime代码、auxdata。

部署代码：以上面的输出结果为例，EVM虚拟机在创建合约的时候，会先创建合约账户，然后运行部署代码。运行完成后它会将runtime代码+auxdata 存储到区块链上。之后再把二者的存储地址跟合约账户关联起来(也就是把合约账户中的code hash字段用该地址赋值)，这样就完成了合约的部署。


runtime代码：运行时代码。

auxdata：每个合约最后面的43字节就是auxdata，它会紧跟在runtime代码后面被存储起来，是源码的加密指纹，用来验证。这只是数据，永远不会被EVM执行。

solc命令的--bin-runtime选项，输出了runtime代码和auxdata，省略了部署代码，使用remix-ide也可以


以下使用0.4.24的编译器做demo演示
```
pragma solidity ^0.4.22;
contract Demo1{
        int m  = 0;

        function add( int x ) public {
                m = m + x + 14 ;
        }
        function get() public view returns (int) {
                return m;
        }

}
```


bytecode

```
60806040526000805534801561001457600080fd5b5060e6806100236000396000f300

6080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680636d4ce63c14604e57806387db03b7146076575b600080fd5b348015605957600080fd5b50606060a0565b6040518082815260200191505060405180910390f35b348015608157600080fd5b50609e6004803603810190808035906020019092919050505060a9565b005b60008054905090565b600e816000540101600081905550505600

a165627a7a7230582040b8d9935d515a6710caa2e4e613b15cff5352bf177a23cd88ebf61f059720130029

```
runtime bytecode
```
6080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680636d4ce63c14604e57806387db03b7146076575b600080fd5b348015605957600080fd5b50606060a0565b6040518082815260200191505060405180910390f35b348015608157600080fd5b50609e6004803603810190808035906020019092919050505060a9565b005b60008054905090565b600e816000540101600081905550505600

a165627a7a7230582040b8d9935d515a6710caa2e4e613b15cff5352bf177a23cd88ebf61f059720130029
```
bytecode 种包含了部署代码 和 runtime



拷贝到控制台目录下

```
cp ~/Documents/learn/discuss-fisco-bcos/code_and_doc/Demo1.sol ~/2cWorkPlace/demo-fisco-bcos/demo2/nodes/127.0.0.1/console/contracts/solidity/Demo1.sol
```

部署合约，查看交易详情
```
deploy Demo

//控制台打印出了合约地址
0xd9318a2549e48d9550845a2d2e4cdd313a4998a3

//通过交易查询详情
getTransactionByHash  0x16455c29dd0875f8cd31ae9160d63feafe339c13498fc3ba7c1df66207b544f6

0x60806040526000805534801561001457600080fd5b5060e6806100236000396000f3006080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680636d4ce63c14604e57806387db03b7146076575b600080fd5b348015605957600080fd5b50606060a0565b6040518082815260200191505060405180910390f35b348015608157600080fd5b50609e6004803603810190808035906020019092919050505060a9565b005b60008054905090565b600e816000540101600081905550505600a165627a7a723058203a4a66fdef92e7dca88190b53b3dfba1885c989317b71a43572d279c209d5dfb0029

//对比得到部署代码和runtime代码一样

//获取合约详情
getCode 0xd9318a2549e48d9550845a2d2e4cdd313a4998a3

0x6080604052600436106049576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680636d4ce63c14604e57806387db03b7146076575b600080fd5b348015605957600080fd5b50606060a0565b6040518082815260200191505060405180910390f35b348015608157600080fd5b50609e6004803603810190808035906020019092919050505060a9565b005b60008054905090565b600e816000540101600081905550505600a165627a7a723058203a4a66fdef92e7dca88190b53b3dfba1885c989317b71a43572d279c209d5dfb0029
//得到runTime代码，此时部署合约代码和runtime代码已经分离
```

